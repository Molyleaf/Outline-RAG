<!doctype html>
<html lang="zh">
<head>
	<meta charset="utf-8" />
	<title>Outline RAG Chat</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="icon" href="static/favicon.svg" type="image/svg+xml" />
	<link rel="icon" href="static/favicon.ico" />
	<link rel="stylesheet" href="static/style.css" />
	<!-- 不要更改CDN源 -->
	<script type="module" src="https://unpkg.shop.jd.com/@shoelace-style/shoelace/cdn/shoelace-autoloader.js"></script>
	<link rel="stylesheet" href="https://unpkg.shop.jd.com/@shoelace-style/shoelace/cdn/themes/light.css" />
	<script src="https://unpkg.shop.jd.com/marked@16.3.0/lib/marked.esm.js" defer></script>
	<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.11.1/highlight.min.js" defer></script>
	<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/highlight.js/11.11.1/styles/googlecode.min.css">
	<script>
        (function () {
            try {
                const saved = localStorage.getItem('theme');
                const root = document.documentElement;
                if (saved === 'light' || saved === 'dark') {
                    root.setAttribute('data-theme', saved);
                } else {
                    root.setAttribute('data-theme', 'system');
                }
            } catch (e) {}
        })();
	</script>
</head>
<body>
<div class="app">
	<div class="sidebar">
		<div class="titlebar">
			<strong>对话</strong>
			<button class="btn tonal" id="newConv"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>新建</button>
		</div>
		<div id="convs"></div>
	</div>
	<div class="sidebar-veil"></div>
	<div class="main">
		<div class="topbar">
			<div class="hamburger">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
			</div>
			<div class="actions">
				<label class="upload">
					<input type="file" id="fileInput" style="display:none" />
					<span class="btn tonal">上传附件</span>
				</label>
			</div>
			<!-- (Req 9) 移除 style="display:none" -->
			<div class="menu" id="menu">
				<div class="menu-section">
					<div class="menu-label">主题</div>
					<div class="menu-radio" data-theme="system">系统</div>
					<div class="menu-radio" data-theme="light">浅色</div>
					<div class="menu-radio" data-theme="dark">深色</div>
				</div>
				<div class="menu-divider"></div>
				<a href="/chat/logout">登出</a>
				<a id="refreshAll" href="#">手动刷新数据库</a>
			</div>
			<div class="avatar" id="avatar" title="菜单"></div>
		</div>
		<div class="chat" id="chat">
			<div class="greeting" id="greeting">
				<div class="greet-title">你好！</div>
				<div class="greet-sub">随时提问，或从以下示例开始</div>
				<div class="greet-suggestions">
					<button class="chip">总结新手教程</button>
					<button class="chip">拉汶帝国完蛋了吗</button>
					<button class="chip">开发组的烂摊子怎么样了</button>
				</div>
			</div>
		</div>
		<div class="input">
			<div class="input-inner">
				<textarea id="q" placeholder="向知识库提问... (Shift+Enter 换行)"></textarea>
				<button class="btn" id="send"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg></button>
			</div>
			<label class="switch" style="display:none">
				<input type="checkbox" id="streamToggle" checked />
				<span>流式</span>
			</label>
		</div>
	</div>
</div>

<!-- (Req 1) 添加 defer -->
<script src="static/script.js" defer></script>
<script>
    (function(){
        const m = document.cookie.match(/(?:^|;\s*)chat_notice=([^;]+)/);
        if (m) {
            try {
                const msg = decodeURIComponent(m[1]);
                if (msg) toast(msg, 'warning', 3000);
            } catch(_) {}
            document.cookie = 'chat_notice=; Max-Age=0; path=/';
        }
    })();
    (function(){
        document.querySelectorAll('.greet-suggestions .chip').forEach(btn=>{
            btn.addEventListener('click', ()=>{
                const q = document.getElementById('q');
                q.value = btn.textContent.trim();
                q.focus();
            });
        });
    })();
</script>
</body>
</html>
