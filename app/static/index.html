<!doctype html>
<html lang="zh">
<head>
	<meta charset="utf-8" />
	<title>{{ app_name }}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
	<link rel="icon" href="/chat/static/img/favicon.svg" type="image/svg+xml" />
	<link rel="icon" href="/chat/static/img/favicon.ico" type="image/x-icon"/>

	<link rel="stylesheet" href="static/style.min.css" />

	<link rel="stylesheet" href="https://unpkg.shop.jd.com/@shoelace-style/shoelace@2.20.1/cdn/themes/light.css" />
	<script type="module" src="https://unpkg.shop.jd.com/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js"></script>

	<script type="module" src="https://unpkg.shop.jd.com/marked@16.3.0/lib/marked.umd.js" defer></script>
	<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.11.1/highlight.min.js" defer></script>
	<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/highlight.js/11.11.1/styles/github.min.css" id="hljs-light-theme">
	<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/highlight.js/11.11.1/styles/github-dark.min.css" id="hljs-dark-theme" disabled>

	<script>
        /* 快速防闪烁主题脚本 */
        (function () {
            try {
                const saved = localStorage.getItem('theme');
                const root = document.documentElement;
                if (saved === 'light' || saved === 'dark') {
                    root.setAttribute('data-theme', saved);
                    if (saved === 'dark') document.documentElement.classList.add('sl-theme-dark');
                } else {
                    root.setAttribute('data-theme', 'system');
                    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        document.documentElement.classList.add('sl-theme-dark');
                    }
                }
            } catch (e) {}
        })();
	</script>
</head>
<body>
<div class="app">
	<div class="sidebar">
		<div class="titlebar">
			<strong style="font-size: 18px;">对话</strong>
			<button class="btn tonal" id="newConv" style="height:32px; font-size:13px;">
				<sl-icon name="plus-lg" style="font-size: 16px; margin-right: 4px;"></sl-icon>
				新建
			</button>
		</div>
		<div id="convs"></div>
	</div>

	<div class="sidebar-veil"></div>

	<div class="main">
		<div class="topbar">
			<div class="hamburger">
				<sl-icon name="list" style="font-size: 24px;"></sl-icon>
			</div>
			<div class="actions">
				<label class="upload" title="上传文件">
					<input type="file" id="fileInput" style="display:none" />
					<span class="btn tonal" style="width:40px; height:40px; padding:0; border-radius:50%;">
                        <sl-icon name="paperclip" style="font-size: 20px;"></sl-icon>
                    </span>
				</label>
			</div>
			<div class="menu" id="menu">
				<div class="menu-section">
					<div class="menu-label">主题</div>
					<div class="menu-radio" data-theme="system">系统默认</div>
					<div class="menu-radio" data-theme="light">浅色模式</div>
					<div class="menu-radio" data-theme="dark">深色模式</div>
				</div>
				<div class="menu-divider"></div>
				<a href="/chat/logout">退出登录</a>
				<a id="refreshAll" href="#">刷新知识库</a>
			</div>
			<div class="avatar" id="avatar" title="用户菜单"></div>
		</div>

		<div class="chat" id="chat">
			<div class="greeting" id="greeting">
				<div class="greet-title">你好</div>
				<div class="greet-sub">探索知识库，或尝试以下问题</div>
				<div class="greet-suggestions">
					<button class="chip">总结新手教程</button>
					<button class="chip">为拉汶帝国写一段新剧情</button>
					<button class="chip">扮演艾琳与我对话</button>
				</div>
			</div>
		</div>

		<div class="input">
			<div class="input-inner">
				<textarea id="q" placeholder="输入问题..." rows="1" autofocus></textarea>
				<button id="send" title="发送">
					<sl-icon name="arrow-up" style="font-size: 22px; stroke-width: 2px;"></sl-icon>
				</button>
			</div>
			<label class="switch" style="display:none">
				<input type="checkbox" id="streamToggle" checked />
				<span>流式</span>
			</label>
		</div>
	</div>
</div>

<script src="static/script.min.js" defer></script>
<script>
    /* 辅助脚本：监听系统主题变化以切换 Shoelace 主题类 */
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (document.documentElement.getAttribute('data-theme') === 'system') {
            if(e.matches) document.documentElement.classList.add('sl-theme-dark');
            else document.documentElement.classList.remove('sl-theme-dark');
        }
    });
</script>
</body>
</html>