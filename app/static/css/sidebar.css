/* 侧栏容器 */
.sidebar {
    height: 100%;
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--border);
    background: var(--bg); /* 侧栏使用浅灰/背景色，与主内容区区分 */
    overflow: hidden;
}

.titlebar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px;
    gap: 8px;
}

/* 新建会话按钮 */
#newConv {
    /* 具体样式在 main.css .btn 中定义 */
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
#newConv:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: var(--shadow-2);
}
#newConv:active {
    transform: scale(0.97);
}

/* 会话列表 */
#convs {
    padding: 0 8px 10px;
    overflow-y: auto;
    flex: 1;
}

.conv {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: var(--radius-s);
    cursor: pointer;
    color: var(--text);
    font-size: 14px;
    margin-bottom: 2px;
    transition: background 0.1s, transform 0.2s ease; /* 增加位移动画 */
}
.conv:hover {
    background: color-mix(in srgb, var(--text) 6%, transparent);
    transform: translateX(4px); /* 悬停右移 */
}
.conv.active {
    background: color-mix(in srgb, var(--accent) 15%, transparent);
    color: var(--accent);
    font-weight: 500;
}
.conv:active {
    transform: translateX(2px);
}

.conv-title {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
}

/* 会话菜单按钮 */
.sidebar .conv { position: relative; }
.sidebar .conv .conv-menu {
    /* 改为使用透明度 + pointer-events，避免 hover 抢占交互 */
    opacity: 0;
    pointer-events: none;
    border: none;
    background: transparent;
    cursor: pointer;
    color: var(--muted);
    padding: 4px;
    border-radius: 4px;
    display: flex;
    align-items: center;

    transition: opacity 0.15s ease, background 0.15s ease, color 0.15s ease;
}

/* 悬停整行时显示按钮 */
.sidebar .conv:hover .conv-menu {
    opacity: 1;
    pointer-events: auto;
}

/* 弹窗打开时，即便不 hover 也保持按钮可见 */
.sidebar .conv .conv-menu-pop.visible ~ .conv-menu {
    opacity: 1;
    pointer-events: auto;
}

/* 针对 Shoelace sl-icon-button 的基座样式 */
.sidebar .conv .conv-menu::part(base) {
    padding: 4px;
    border-radius: 4px;
    color: var(--muted);
}
.sidebar .conv .conv-menu:hover::part(base) {
    background: rgba(0,0,0,0.06);
    color: var(--text);
}

/* 会话操作弹窗 */
.sidebar .conv .conv-menu-pop {
    position: absolute; right: 8px; top: 36px;
    background: var(--panel); border: 1px solid var(--border);
    box-shadow: var(--shadow-2); z-index: 10; border-radius: var(--radius-s);
    visibility: hidden; opacity: 0;
    transform: scale(0.95) translate(-5px, -5px);
    transform-origin: top left;
    transition: all 0.15s ease;
    min-width: 140px;
    padding: 4px;
    /* 确保弹层本身始终可交互 */
    pointer-events: none;
}
.sidebar .conv .conv-menu-pop.visible {
    visibility: visible; opacity: 1; transform: scale(1) translate(0, 0);
    pointer-events: auto;
}
.sidebar .conv .conv-menu-pop > div {
    padding: 8px 12px; cursor: pointer;
    border-radius: 4px; font-size: 13px;
}
.sidebar .conv .conv-menu-pop > div:hover { background: color-mix(in srgb, var(--bg) 90%, var(--text)); }


/* 移动端抽屉样式 */
.app .sidebar-veil { display: none; }
@media (max-width: 960px) {
    .app { grid-template-columns: 1fr; }
    .sidebar {
        position: fixed;
        inset: 0 auto 0 0;
        width: 80%; max-width: 300px;
        transform: translateX(-102%);
        transition: transform .3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 100;
        box-shadow: none;
        border-right: none;
    }
    .app.sidebar-open .sidebar {
        transform: translateX(0);
        box-shadow: var(--shadow-2);
    }
    .app .sidebar-veil {
        display: block;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.4);
        opacity: 0;
        pointer-events: none;
        transition: opacity .3s;
        z-index: 99;
    }
    .app.sidebar-open .sidebar-veil {
        opacity: 1; pointer-events: auto;
    }
    /* 移动端仍然隐藏右侧菜单按钮，继续使用长按 Action Sheet 逻辑 */
    .sidebar .conv .conv-menu { display: none; }
}