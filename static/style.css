/* 基础与主题变量（Material 3 风格） */
:root {
    --md-sys-color-primary: #6750A4;
    --md-sys-color-on-primary: #FFFFFF;
    --md-sys-color-primary-container: #EADDFF;
    --md-sys-color-on-primary-container: #21005D;

    --md-sys-color-secondary: #625B71;
    --md-sys-color-on-secondary: #FFFFFF;
    --md-sys-color-secondary-container: #E8DEF8;
    --md-sys-color-on-secondary-container: #1D192B;

    --md-sys-color-surface: #FFFBFE;
    --md-sys-color-on-surface: #1C1B1F;
    --md-sys-color-surface-variant: #E7E0EC;
    --md-sys-color-outline: #79747E;

    --md-sys-color-inverse-surface: #313033;
    --md-sys-color-inverse-on-surface: #F4EFF4;

    --md-sys-elevation-1: 0 1px 2px rgba(0,0,0,.12), 0 1px 3px rgba(0,0,0,.08);
    --md-sys-elevation-2: 0 2px 6px rgba(0,0,0,.12), 0 2px 4px rgba(0,0,0,.10);
    --radius-m: 12px;
    --radius-s: 8px;
    --gap: 12px;

    --chat-bubble-user: color-mix(in srgb, var(--md-sys-color-primary-container) 88%, white);
    --chat-bubble-assistant: color-mix(in srgb, var(--md-sys-color-surface-variant) 60%, white);
}

@media (prefers-color-scheme: dark) {
    :root[data-theme="system"] {
        --md-sys-color-primary: #D0BCFF;
        --md-sys-color-on-primary: #381E72;
        --md-sys-color-primary-container: #4F378B;
        --md-sys-color-on-primary-container: #EADDFF;

        --md-sys-color-secondary: #CCC2DC;
        --md-sys-color-on-secondary: #332D41;
        --md-sys-color-secondary-container: #4A4458;
        --md-sys-color-on-secondary-container: #E8DEF8;

        --md-sys-color-surface: #1C1B1F;
        --md-sys-color-on-surface: #E6E1E5;
        --md-sys-color-surface-variant: #49454F;
        --md-sys-color-outline: #938F99;

        --gemini-bg: radial-gradient(circle at 100% 100%, #3a325a 0%, #1a1629 30%, #0c0c11 70%);

        --chat-bubble-user: color-mix(in srgb, var(--md-sys-color-primary-container) 70%, black);
        --chat-bubble-assistant: #111322;
    }
}

:root[data-theme="dark"] {
    --md-sys-color-primary: #D0BCFF;
    --md-sys-color-on-primary: #381E72;
    --md-sys-color-primary-container: #4F378B;
    --md-sys-color-on-primary-container: #EADDFF;

    --md-sys-color-secondary: #CCC2DC;
    --md-sys-color-on-secondary: #332D41;
    --md-sys-color-secondary-container: #4A4458;
    --md-sys-color-on-secondary-container: #E8DEF8;

    --md-sys-color-surface: #1C1B1F;
    --md-sys-color-on-surface: #E6E1E5;
    --md-sys-color-surface-variant: #49454F;
    --md-sys-color-outline: #938F99;

    --chat-bubble-user: color-mix(in srgb, var(--md-sys-color-primary-container) 70%, black);
    --chat-bubble-assistant: color-mix(in srgb, var(--md-sys-color-surface-variant) 50%, black);
}

/* 全局排版与布局 */
* { box-sizing: border-box; }
html, body { height: 100%; }
body, html { margin: 0; padding: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: var(--md-sys-color-surface); color: var(--md-sys-color-on-surface); }
a { color: inherit; text-decoration: none; }

.app { display: flex; height: 100%; position: relative; }
.sidebar {
    width: 300px;
    border-right: 1px solid var(--md-sys-color-surface-variant);
    padding: var(--gap);
    overflow-y: auto;
    background: var(--md-sys-color-surface);
    transition: transform .25s ease, box-shadow .25s ease;
    will-change: transform;
}
.app .sidebar-veil {
    display: none;
}
@media (max-width: 960px) {
    .sidebar {
        position: fixed;
        inset: 0 auto 0 0;
        height: 100%;
        transform: translateX(-102%);
        z-index: 20;
        box-shadow: none;
    }
    .app.sidebar-open .sidebar {
        transform: translateX(0);
        box-shadow: var(--md-sys-elevation-2);
    }
    /* 主区占满宽度，顶部加入汉堡按钮区域 */
    .main { flex: 1; display: flex; flex-direction: column; }
    .topbar { justify-content: space-between; }
    .topbar .hamburger {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px; height: 40px;
        border-radius: 50%;
        border: 1px solid var(--md-sys-color-surface-variant);
        background: var(--md-sys-color-surface);
        cursor: pointer;
    }
    /* 遮罩 */
    .app .sidebar-veil {
        display: block;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.32);
        opacity: 0;
        pointer-events: none;
        transition: opacity .2s ease;
        z-index: 15;
    }
    .app.sidebar-open .sidebar-veil {
        opacity: 1;
        pointer-events: auto;
    }
}
.titlebar {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;
}

#newConv {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border-radius: 24px !important;
    padding: 8px 16px !important;
}

/* 主区域 */
.main { flex: 1; display: flex; flex-direction: column; background: var(--gemini-bg, var(--md-sys-color-surface)); }

.topbar .hamburger { display: none; }

/* 顶栏 */
.topbar {
    height: 64px;
    border-bottom: 1px solid var(--md-sys-color-surface-variant);
    display: flex; align-items: center; justify-content: flex-end;
    padding: 0 var(--gap); position: relative; gap: 8px;
    background: var(--md-sys-color-surface);
    backdrop-filter: saturate(120%) blur(6px);
}

/* 按钮（Material 变体：Filled / Tonal） */
.btn {
    padding: 10px 14px;
    background: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
    border: none; cursor: pointer; border-radius: var(--radius-s);
    box-shadow: var(--md-sys-elevation-1);
    transition: transform .06s ease, box-shadow .2s ease, background .2s ease, opacity .2s ease;
    font-weight: 600;
}
.btn:hover { transform: translateY(-1px); box-shadow: var(--md-sys-elevation-2); }
.btn:active { transform: translateY(0); }
.btn.tonal {
    background: var(--md-sys-color-primary-container);
    color: var(--md-sys-color-on-primary-container);
}

/* 头像与菜单（Material Menu） */
.avatar {
    width: 40px; height: 40px; border-radius: 50%; cursor: pointer;
    background-size: cover; background-position: center;
    box-shadow: var(--md-sys-elevation-1);
}
.menu {
    position: absolute; right: 12px; top: 64px;
    background: var(--md-sys-color-surface);
    border: 1px solid var(--md-sys-color-surface-variant);
    box-shadow: var(--md-sys-elevation-2);
    display: none; z-index: 10; border-radius: var(--radius-m); min-width: 220px; overflow: hidden;
}
.menu a, .menu .menu-radio {
    display: block; padding: 10px 14px; color: var(--md-sys-color-on-surface);
}
.menu a:hover, .menu .menu-radio:hover { background: color-mix(in srgb, var(--md-sys-color-surface-variant) 35%, transparent); }
.menu .menu-section { padding: 8px 0 0; }
.menu .menu-label { padding: 0 14px 4px; font-size: 12px; color: var(--md-sys-color-outline); text-transform: uppercase; letter-spacing: .04em; }
.menu .menu-divider { height: 1px; background: var(--md-sys-color-surface-variant); margin: 8px 0; }
.menu .menu-radio.active { font-weight: 700; }

/* 聊天区与消息气泡（Material Shape） */
.chat { flex: 1; padding: calc(var(--gap) + 4px) 15%; overflow-y: auto; background: transparent; }
.msg { margin: 10px 0; padding: 14px 16px; border-radius: 16px; max-width: 90%; white-space: pre-wrap; box-shadow: var(--md-sys-elevation-1); }
.msg.user { background: var(--chat-bubble-user); margin-left: auto; border-radius: 16px 16px 4px 16px; }
.msg.assistant { background: var(--chat-bubble-assistant); margin-right: auto; border-radius: 4px 16px 16px 16px;}
/* 分组间距：不同说话方之间增加更大间距，增强分段感 */
.msg + .msg { margin-top: 8px; }
.msg.user + .msg.assistant,
.msg.assistant + .msg.user { margin-top: 16px; }

/* Markdown 内容样式适配 */
.md-body {
    line-height: 1.6;
}
.md-body pre {
    background: color-mix(in srgb, var(--md-sys-color-surface-variant) 35%, transparent);
    padding: 10px 12px; border-radius: 12px; overflow: auto;
    border: 1px solid var(--md-sys-color-surface-variant);
}
.md-body code {
    background: color-mix(in srgb, var(--md-sys-color-surface-variant) 30%, transparent);
    padding: 2px 6px; border-radius: 6px;
}
.md-body h1, .md-body h2, .md-body h3 { margin: .8em 0 .4em; }
.md-body ul, .md-body ol { padding-left: 1.2em; }

/* 会话项（List + states） */
.conv { padding: 10px 12px; border-radius: var(--radius-s); cursor: pointer; display: flex; align-items: center; justify-content: space-between; gap: 8px; margin-bottom: 8px; }
.conv + .conv { margin-top: 6px; }
.conv.active { background: color-mix(in srgb, var(--md-sys-color-primary-container) 60%, transparent); }
.conv:hover { background: color-mix(in srgb, var(--md-sys-color-primary-container) 40%, transparent); }

/* 会话项右侧菜单 */
.sidebar .conv { position: relative; }
.sidebar .conv .conv-menu { visibility: hidden; border: none; background: transparent; cursor: pointer; font-size: 18px; padding: 2px 6px; color: var(--md-sys-color-on-surface); }
.sidebar .conv:hover .conv-menu { visibility: visible; }
.sidebar .conv .conv-menu-pop {
    position: absolute; right: 6px; top: 26px;
    background: var(--md-sys-color-surface); border: 1px solid var(--md-sys-color-surface-variant);
    box-shadow: var(--md-sys-elevation-2); z-index: 10; border-radius: var(--radius-s);
}
.sidebar .conv .conv-menu-pop > div { padding: 8px 12px; cursor: pointer; white-space: nowrap; }
.sidebar .conv .conv-menu-pop > div:hover { background: color-mix(in srgb, var(--md-sys-color-surface-variant) 35%, transparent); }

/* 输入区 */
.input {
    border-top: none;
    padding: var(--gap) 15%;
    display: flex;
    gap: 8px;
    align-items: flex-end;
    background: transparent;
    position: sticky;
    bottom: 0;
}
.input-inner {
    flex: 1;
    display: flex;
    align-items: flex-end;
    padding: 8px 8px 8px 20px;
    border-radius: 28px;
    background: var(--chat-bubble-assistant);
    border: 1px solid var(--md-sys-color-outline);
    gap: 8px;
    transition: border-color .2s ease, box-shadow .2s ease;
}
.input-inner:focus-within {
    border-color: var(--md-sys-color-primary);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-sys-color-primary) 25%, transparent);
}
.input textarea {
    flex: 1;
    height: 26px; /* initial height */
    max-height: 250px;
    resize: none;
    padding: 0;
    border-radius: 0;
    border: none;
    background: transparent;
    color: var(--md-sys-color-on-surface);
    outline: none;
    line-height: 26px;
    font-size: 16px;
    font-family: inherit;
}
#send {
    width: 40px;
    height: 40px;
    border-radius: 50% !important;
    padding: 0 !important;
    box-shadow: none !important;
    background: var(--md-sys-color-primary) !important;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
#send:hover {
    transform: none;
    box-shadow: none !important;
}


/* 开关 */
.switch { display: flex; align-items: center; gap: 6px; color: var(--md-sys-color-outline); }

/* 上传 */
.upload { cursor: pointer; }