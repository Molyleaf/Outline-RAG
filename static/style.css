/* 基础与主题变量（Material 3 风格） */
:root {
    --md-sys-color-primary: #6750A4;
    --md-sys-color-on-primary: #FFFFFF;
    --md-sys-color-primary-container: #EADDFF;
    --md-sys-color-on-primary-container: #21005D;

    --md-sys-color-secondary: #625B71;
    --md-sys-color-on-secondary: #FFFFFF;
    --md-sys-color-secondary-container: #E8DEF8;
    --md-sys-color-on-secondary-container: #1D192B;

    /* 基础主色保持不动或按需覆盖，这里主要替换表层配色 */
    --md-sys-color-surface: #FFFFFF;            /* 浅色-层底 */
    --md-sys-color-on-surface: #575B60;         /* 浅色-文字 */
    --md-sys-color-surface-variant: #F0F4F9;    /* 浅色-分割/边框 */
    --md-sys-color-outline: #F0F4F9;            /* 浅色-描边与容器 */
    /* 适配聊天气泡对比 */
    --chat-bubble-user: #F8FAFD;
    --chat-bubble-assistant: #F0F4F9;

    --md-sys-color-inverse-surface: #313033;
    --md-sys-color-inverse-on-surface: #F4EFF4;

    --md-sys-elevation-1: 0 1px 2px rgba(0,0,0,.12), 0 1px 3px rgba(0,0,0,.08);
    --md-sys-elevation-2: 0 2px 6px rgba(0,0,0,.12), 0 2px 4px rgba(0,0,0,.10);
    --radius-m: 12px;
    --radius-s: 8px;
    --gap: 12px;
}
/* 系统深色（跟随系统时） */
@media (prefers-color-scheme: dark) {
    :root[data-theme="system"] {
        --md-sys-color-surface: #1B1C1D;            /* 深色-层底 */
        --md-sys-color-on-surface: #A2A9B0;         /* 深色-文字 */
        --md-sys-color-surface-variant: #282A2C;    /* 深色-分割/边框 */
        --md-sys-color-outline: #282A2C;            /* 深色-描边与容器 */
        --chat-bubble-user: #262627;
        --chat-bubble-assistant: #282A2C;

        --md-sys-color-primary: #D0BCFF;
        --md-sys-color-on-primary: #381E72;
        --md-sys-color-primary-container: #4F378B;
        --md-sys-color-on-primary-container: #EADDFF;

        --md-sys-color-secondary: #CCC2DC;
        --md-sys-color-on-secondary: #332D41;
        --md-sys-color-secondary-container: #4A4458;
        --md-sys-color-on-secondary-container: #E8DEF8;

        --gemini-bg: radial-gradient(circle at 100% 100%, #3a325a 0%, #1a1629 30%, #0c0c11 70%);
    }
}
/* 强制深色 */
:root[data-theme="dark"] {
    --md-sys-color-surface: #1B1C1D;
    --md-sys-color-on-surface: #A2A9B0;
    --md-sys-color-surface-variant: #282A2C;
    --md-sys-color-outline: #282A2C;
    --chat-bubble-user: #262627;
    --chat-bubble-assistant: #282A2C;

    --md-sys-color-primary: #D0BCFF;
    --md-sys-color-on-primary: #381E72;
    --md-sys-color-primary-container: #4F378B;
    --md-sys-color-on-primary-container: #EADDFF;

    --md-sys-color-secondary: #CCC2DC;
    --md-sys-color-on-secondary: #332D41;
    --md-sys-color-secondary-container: #4A4458;
    --md-sys-color-on-secondary-container: #E8DEF8;
}
/* 保持按钮主色可读性（按需可改） */

/* 全局排版与布局 */
* { box-sizing: border-box; }
html, body { height: 100%; }
body, html { margin: 0; padding: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: var(--md-sys-color-surface); color: var(--md-sys-color-on-surface); }
a { color: inherit; text-decoration: none; }

.app { display: flex; height: 100%; position: relative; }
.sidebar {
    width: 300px;
    border-right: 1px solid var(--md-sys-color-surface-variant);
    padding: var(--gap);
    overflow-y: auto;
    background: var(--md-sys-color-surface);
    transition: transform .25s ease, box-shadow .25s ease;
    will-change: transform;
}
.app .sidebar-veil {
    display: none;
}
@media (max-width: 960px) {
    .sidebar {
        position: fixed;
        inset: 0 auto 0 0;
        height: 100%;
        transform: translateX(-102%);
        z-index: 20;
        box-shadow: none;
    }
    .app.sidebar-open .sidebar {
        transform: translateX(0);
        box-shadow: var(--md-sys-elevation-2);
    }
    /* 主区占满宽度，顶部加入汉堡按钮区域 */
    .main { flex: 1; display: flex; flex-direction: column; }
    .topbar { justify-content: space-between; }
    .topbar .hamburger {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px; height: 40px;
        border-radius: 50%;
        border: 1px solid var(--md-sys-color-surface-variant);
        background: var(--md-sys-color-surface);
        cursor: pointer;
    }
    /* 遮罩 */
    .app .sidebar-veil {
        display: block;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.32);
        opacity: 0;
        pointer-events: none;
        transition: opacity .2s ease;
        z-index: 15;
    }
    .app.sidebar-open .sidebar-veil {
        opacity: 1;
        pointer-events: auto;
    }
}
.titlebar {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;
}

/* 标题栏按钮尺寸随高度调整略收紧 */
#newConv {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border-radius: 22px !important;
    padding: 6px 12px !important;
}

/* 主区域 */
.main { flex: 1; display: flex; flex-direction: column; background: var(--gemini-bg, var(--md-sys-color-surface)); }

.topbar .hamburger { display: none; }

/* 顶栏 */
.topbar {
    height: 56px;
    border-bottom: 1px solid var(--md-sys-color-surface-variant);
    display: flex; align-items: center; justify-content: flex-end;
    padding: 0 10px; position: relative; gap: 8px;
    background: var(--md-sys-color-surface);
    backdrop-filter: saturate(120%) blur(6px);
}

/* 按钮（Material 变体：Filled / Tonal） */
.btn {
    padding: 10px 14px;
    background: var(--md-sys-color-primary);
    color: var(--md-sys-color-on-primary);
    border: none; cursor: pointer; border-radius: var(--radius-s);
    box-shadow: var(--md-sys-elevation-1);
    transition: transform .06s ease, box-shadow .2s ease, background .2s ease, opacity .2s ease;
    font-weight: 600;
}
.btn:hover { transform: translateY(-1px); box-shadow: var(--md-sys-elevation-2); }
.btn:active { transform: translateY(0); }
.btn.tonal {
    background: var(--md-sys-color-primary-container);
    color: var(--md-sys-color-on-primary-container);
}

/* 头像与菜单（Material Menu） */
.avatar {
    width: 40px; height: 40px; border-radius: 50%; cursor: pointer;
    background-size: cover; background-position: center;
    image-rendering: -webkit-optimize-contrast; /* 提升头像清晰度（WebKit） */
    image-rendering: crisp-edges;               /* 非标准，部分浏览器有帮助 */
    box-shadow: var(--md-sys-elevation-1);
}
/* Gemini 风格：更紧凑的灰度与装饰 */
.chat { flex: 1; padding: calc(var(--gap) + 4px) 12%; }
/* 问候语块（仿 Gemini） */
.greeting {
    max-width: 680px;
    margin: 8vh auto 2vh;
    text-align: left;
    color: var(--md-sys-color-on-surface);
}
.greet-title {
    font-size: 28px;
    font-weight: 800;
    letter-spacing: .2px;
    margin-bottom: 8px;
    /* 问候语标题滚动渐变文字 */
    background: linear-gradient(90deg, #3183FD, #336EF2, #3183FD);
    background-size: 200% auto;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: gradient-scroll 6s linear infinite;
}
@keyframes gradient-scroll {
    0% { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
}
.greet-sub {
    font-size: 14px;
    color: color-mix(in srgb, var(--md-sys-color-on-surface) 70%, #666);
    margin-bottom: 16px;
}
.greet-suggestions { display: flex; flex-wrap: wrap; gap: 8px; }
.chip {
    border: 1px solid var(--md-sys-color-surface-variant);
    background: color-mix(in srgb, var(--md-sys-color-surface-variant) 18%, transparent);
    color: var(--md-sys-color-on-surface);
    padding: 8px 12px;
    border-radius: 999px;
    font-size: 14px;
    cursor: pointer;
}
.chip:hover {
    background: color-mix(in srgb, var(--md-sys-color-surface-variant) 28%, transparent);
}
/* 更接近 Gemini 的灰度与字间距（总体更紧凑） */
body, html { letter-spacing: 0; }
.md-body { line-height: 1.5; letter-spacing: .1px; color: color-mix(in srgb, var(--md-sys-color-on-surface) 92%, #777); }
.msg.assistant { background: color-mix(in srgb, var(--md-sys-color-surface-variant) 45%, transparent); }
.input-inner { background: color-mix(in srgb, var(--md-sys-color-surface-variant) 30%, transparent); }
/* 移动端边栏与按钮可见性（确保显示） */
@media (max-width: 960px) {
    .topbar .hamburger { display: inline-flex; }
    .app .sidebar-veil { display: block; } /* 显示遮罩，支持点击关闭 */
}
.menu {
    position: absolute; right: 12px; top: 64px;
    background: var(--md-sys-color-surface);
    border: 1px solid var(--md-sys-color-surface-variant);
    box-shadow: var(--md-sys-elevation-2);
    display: none; z-index: 10; border-radius: var(--radius-m); min-width: 220px; overflow: hidden;
}
.menu a, .menu .menu-radio {
    display: block; padding: 10px 14px; color: var(--md-sys-color-on-surface);
}
.menu a:hover, .menu .menu-radio:hover { background: color-mix(in srgb, var(--md-sys-color-surface-variant) 35%, transparent); }
.menu .menu-section { padding: 8px 0 0; }
.menu .menu-label { padding: 0 14px 4px; font-size: 12px; color: var(--md-sys-color-outline); text-transform: uppercase; letter-spacing: .04em; }
.menu .menu-divider { height: 1px; background: var(--md-sys-color-surface-variant); margin: 8px 0; }
.menu .menu-radio.active { font-weight: 700; }

/* 聊天区与消息气泡（Material Shape） */
.msg { margin: 10px 0; padding: 14px 16px; border-radius: 16px; max-width: 90%; white-space: pre-wrap; box-shadow: var(--md-sys-elevation-1); }
.msg.user { background: var(--chat-bubble-user); margin-left: auto; border-radius: 16px 16px 4px 16px; }
.msg.assistant { background: var(--chat-bubble-assistant); margin-right: auto; border-radius: 4px 16px 16px 16px;}
/* 分组间距：不同说话方之间增加更大间距，增强分段感 */
.msg + .msg { margin-top: 8px; }
.msg.user + .msg.assistant,
.msg.assistant + .msg.user { margin-top: 16px; }

/* Markdown 内容样式适配 */
.md-body pre {
    background: color-mix(in srgb, var(--md-sys-color-surface-variant) 35%, transparent);
    padding: 10px 12px; border-radius: 12px; overflow: auto;
    border: 1px solid var(--md-sys-color-surface-variant);
}
.md-body code {
    background: color-mix(in srgb, var(--md-sys-color-surface-variant) 30%, transparent);
    padding: 2px 6px; border-radius: 6px;
}
.md-body h1, .md-body h2, .md-body h3 { margin: .8em 0 .4em; }
.md-body ul, .md-body ol { padding-left: 1.2em; }
/* <br> 行距合理化：仅对段内换行收紧 */
.md-body br {
    line-height: 1.2;
}
/* 会话项（List + states） */
.conv { padding: 10px 12px; border-radius: var(--radius-s); cursor: pointer; display: flex; align-items: center; justify-content: space-between; gap: 8px; margin-bottom: 8px; }
.conv + .conv { margin-top: 6px; }
.conv.active { background: color-mix(in srgb, var(--md-sys-color-primary-container) 60%, transparent); }
.conv:hover { background: color-mix(in srgb, var(--md-sys-color-primary-container) 40%, transparent); }

/* 会话项右侧菜单 */
.sidebar .conv { position: relative; }
.sidebar .conv .conv-menu { visibility: hidden; border: none; background: transparent; cursor: pointer; font-size: 18px; padding: 2px 6px; color: var(--md-sys-color-on-surface); }
.sidebar .conv:hover .conv-menu { visibility: visible; }
.sidebar .conv .conv-menu-pop {
    position: absolute; right: 6px; top: 26px;
    background: var(--md-sys-color-surface); border: 1px solid var(--md-sys-color-surface-variant);
    box-shadow: var(--md-sys-elevation-2); z-index: 10; border-radius: var(--radius-s);
}
.sidebar .conv .conv-menu-pop > div { padding: 8px 12px; cursor: pointer; white-space: nowrap; }
.sidebar .conv .conv-menu-pop > div:hover { background: color-mix(in srgb, var(--md-sys-color-surface-variant) 35%, transparent); }

/* 输入区 */
.input {
    border-top: none;
    padding: var(--gap) 15%;
    display: flex;
    gap: 8px;
    align-items: flex-end;
    background: transparent;
    position: sticky;
    bottom: 0;
}
.input-inner {
    flex: 1;
    display: flex;
    align-items: flex-end;
    padding: 8px 8px 8px 20px;
    border-radius: 28px;
    background: var(--chat-bubble-assistant);
    border: 1px solid var(--md-sys-color-outline);
    gap: 8px;
    transition: border-color .2s ease, box-shadow .2s ease;
}
.input-inner:focus-within {
    border-color: var(--md-sys-color-primary);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--md-sys-color-primary) 25%, transparent);
}
.input textarea {
    flex: 1;
    height: 26px; /* initial height */
    max-height: 250px;
    resize: none;
    padding: 0;
    border-radius: 0;
    border: none;
    background: transparent;
    color: var(--md-sys-color-on-surface);
    outline: none;
    line-height: 26px;
    font-size: 16px;
    font-family: inherit;
}
#send {
    width: 40px;
    height: 40px;
    border-radius: 50% !important;
    padding: 0 !important;
    box-shadow: none !important;
    background: var(--md-sys-color-primary) !important;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}
#send:hover {
    transform: none;
    box-shadow: none !important;
}


/* 开关 */
.switch { display: flex; align-items: center; gap: 6px; color: var(--md-sys-color-outline); }

/* 上传 */
.upload { cursor: pointer; }